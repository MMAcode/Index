<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="css/style.css">
  <title>Vocabulary Practice by MMAcode</title>

</head>

<body>
  <div id="container">
    <h1>Vocabulary training</h1>
    <h3>
      <a class="button" href="practice.html">learn/practice</a></h3>
    <div id="newWord_container">
      <h4> Add new word to learn:</h4>
      <form action="">
        <label for="nativeInput">Native word:</label>
        <input name="nativeInput" type="text">
        <label for="toLearnInput">Word to learn:</label>
        <input name="toLearnInput" type="text">
        <input type="submit">
      </form>
      <br>
      <p class="centerIt">or</p>
      <a class="centerIt" id="importBtn" href="importFile_video.html">Import from Excel.</a>

    </div>

    <br>
    <!-- <div id="showAllCards">
      Show all cards
    </div> -->
    <br>
    <br>
    <p></p>
    <div id="userStatus"></div>
    <br>
    <a class="button" id="signInOutButton" href="signIn.html">Sign-in</a>
    <br><br>
    <!-- <a id="administrator" href="administrator.html">administrator</a> -->

    <!-- <button id="copyCollection"></button> -->

  </div>














  <!-- firebase package which was originally on the botton -->
  <!-- The core Firebase JS SDK is always required and must be listed first -->
  <script src="https://www.gstatic.com/firebasejs/6.6.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.6.1/firebase-auth.js"></script>
  <script src="https://www.gstatic.com/firebasejs/6.6.1/firebase-firestore.js"></script>
  <!-- <script src="https://www.gstatic.com/firebasejs/7.2.0/firebase-analytics.js"></script> -->

  <script>
    // Your web app's Firebase configuration
    var firebaseConfig = {
      apiKey: "AIzaSyAY9FCIHSK9v0LSa8i_PWxm06kx_Isv4Uo",
      authDomain: "ninja2-634e4.firebaseapp.com",
      databaseURL: "https://ninja2-634e4.firebaseio.com",
      projectId: "ninja2-634e4",
      appId: "1:900566306511:web:044e5cb5c69760492db1ba"
    };
    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    // firebase.analytics();
    const db = firebase.firestore();
    const auth = firebase.auth();
  </script>







  <script>
    // get inputs from the form
    let activateNEwCardListener = (user) => {
      form = document.querySelector('form');
      form.addEventListener('submit', e => {
        e.preventDefault();
        let nativeInput = form.nativeInput.value;
        let toLearnInput = form.toLearnInput.value;

        // add new object into firebase
        const newCard = {
          languageNative: nativeInput,
          languageToLearn: toLearnInput,
          mainStage: 'to learn',
          enCheck: false,
          czCheck: false,
          level: 0,
          dueTime: 8888888888888,
          due: false,
          lastSeen: 8888888888888
        };

        db.collection(user.uid).add(newCard).then(() => {
          console.log('Flip-card added');
        }).catch(err => {
          console.log(err);
          console.log('I could NOT add object into the database.');
        });
        // reset form
        form.reset();
      })
    }











    // buttons
    const ccButton = document.querySelector('#copyCollection');
    const addWordForm = document.querySelector('#newWord_container');
    const importBtnXX = document.querySelector('#importBtn');

    // user button
    let status = document.querySelector('#userStatus');
    let = signButton = document.querySelector('#signInOutButton');

    let changeButtonToSignOut = () => {
      signButton.innerHTML = '<span>Log out.</span>';
      signButton.addEventListener('click', () => {
        auth.signOut();
        status.innerHTML = `<p>xx User logged out.</p>`;
        signButton.innerHTML = '<a href="signIn.html">Sign-in</a>';
      })
    }

    // F copy collection and contained cards exactly - with levels etc
    let copyCollection = async (user) => {
      const cards = db.collection('FlipCards');
      // const userID = user.uid;
      let userCol = db.collection(user.uid);
      let origCol = await cards.get();
      origCol.docs.forEach(doc => {
        // console.log(doc.data());
        userCol.add(doc.data());
      })
    }
    // user status
    auth.onAuthStateChanged(user => {
      if (user) {
        // copy docs from collection to collection
        // ccButton.innerHTML = '<span>Copy default collection of words to my collection.</span>';
        // ccButton.addEventListener('click', () => {
        //   copyCollection(user);
        //   ccButton.style.display = 'none';
        // })
        activateNEwCardListener(user);
        console.log('you are logged in as...');
        console.log(user);
        console.log(user.email);
        console.log(user.uid);
        status.innerHTML = `<p>you are logged in as ${user.email}. Enjoy!</p>`;
        changeButtonToSignOut();

        // check if user doc exists
        let userExists = async () => {
          let userDoc = await db.collection(user.uid).doc(user.uid).get();
          console.log(userDoc);
          console.log('user to ACCESS:', userDoc.exists);
          if (userDoc.exists === true) {
            console.log('user doc exists');

            // ///////count cards
            // db.collection(user.uid).get().then((data) => {
            //   console.log(data.docs.length,' cards');
            // });

            ////////// delete all cards
            // db.collection(user.uid).get().then((data) => {
            //   data.docs.forEach(doc => {
            //     console.log(doc.id);
            //     if (doc.id !== user.uid) {
            //       db.collection(user.uid).doc(doc.id).delete();
            //     }
            //   })
            // });



          } else {
            console.log('user doc doesnt exist, i am going to create one...');
            // here should be initiated for to collect info like language to learn, native language etc. in async mode; then after suplying the data, doc should be created
            let userCollection = db.collection(user.uid).doc(user.uid).set({
              userEmail: user.email,
              userID: user.uid
            });
          };
        };
        userExists();


      } else {
        addWordForm.style.display = 'none';
        // ccButton.style.display = 'none';
        importBtnXX.style.display = 'none';
        console.log('no-one is logged in');
        console.log(user);
        status.innerHTML = '<p>xx No User logged in.</p>';
      }
    });
  </script>


  <!-- <script src="js/bundle.js"></script> -->
</body>

</html>